$=jQuery;$(document).ready(function(){var f=$(".page-question.node-type-questions");$(".page-question-list .field-name-field-experts a").each(function(){$(this).wrap('<div class="field-item"></div>')});$(".page-question .field-name-field-experts a").each(function(){var a=$(this).attr("href");var b=a.split("/");$(this).attr("tid",b[3]);$(this).after('<div class="information"><div class="pic"></div><div class="data"><div></div><div></div></div></div>')});var g;$(".page-question .field-name-field-experts .field-item > a").on("mouseenter",function(){$(this).parent().addClass("open");if(!$(this).next(".information").hasClass("filled")){var a=$(this).attr("tid");var b=$(this);g=$.ajax({type:"GET",url:"/experts/information/"+a,success:function(c){b.next(".information").html('<div class="pic"><image src="'+c.pic+'"/></div><div class="data"><div class="q-count">  سوالات این تخصص : '+c.question_count+' </div><div class="u-count"> کاربران این تخصص : '+c.user_count+'</div><a href="#" target="_blank">دانشنامه</a></div>');b.next(".information").addClass("filled")},error:function(c){}})}});$(".page-question .field-name-field-experts .field-item").on("mouseleave",function(){$(this).removeClass("open");if(g){g.abort()}});$(".page-question .field-name-field-experts .field-item").each(function(){var a=$(this).find("a");a.attr("href","/question/list?field_experts_tid="+a.text());a.attr("target","_blank")});$(".page-question-list .views-field-field-experts a").each(function(){$(this).attr("href","/question/list?field_experts_tid="+$(this).text())});if(Drupal.settings.status){f.addClass(Drupal.settings.status);f.find("#comments form").slideUp();f.find("#comments h2.title.comment-form").removeClass("open")}else{f.find("#comments h2.title.comment-form").addClass("open")}f.find("#comments h2.title.comment-form").click(function(){if(!Drupal.settings.status){$(this).toggleClass("open");f.find("#comments form").slideToggle()}});var e=advisor_prove=0;f.find(".content .comment").each(function(){if($(this).find(".field-name-field-prove-asker .field-item").text()=="1"){$(this).addClass("proved_by_asker");e=1}});f.find(".content .comment").each(function(){if($(this).find(".field-name-field-prove-advisor .field-item").text()=="1"){$(this).addClass("proved_by_advisor");advisor_prove=1}});f.find("#comments > .comment:last-of-type").addClass("last-comment-advisor");f.find(".content .comment .field-name-field-prove-asker").attr("title","تایید شده توسط نویسنده سوال");f.find(".content .comment.proved_by_advisor > div.group-left").attr("title","تایید شده توسط مشاور");f.find(".content .comment.author-advisor > div.group-left").attr("title","پاسخ داده شده توسط مشاور");if(e==0&&(Drupal.settings.Uid==Drupal.settings.asker||f.hasClass("role-administrator"))){f.find(".content .comment").each(function(){var b=$(this).prev().attr("id");var a=b.substr(b.indexOf("-")+1);if(!$(this).parent().hasClass("indented")){$(this).find(".group-left ul").append('<li id="'+a+'" class="asker_aprove"><a>تایید نویسنده سوال</a></li>')}})}if((advisor_prove==0)&&(f.hasClass("role-advisor")||f.hasClass("role-administrator"))){f.find(".content .comment").each(function(){if(!$(this).hasClass("author-advisor")){var b=$(this).prev().attr("id");var a=b.substr(b.indexOf("-")+1);if(!$(this).parent().hasClass("indented")){$(this).find(".group-left ul").append('<li id="'+a+'" class="advisor_aprove"><a>تایید مشاور</a></li>')}}})}f.find(".advisor_aprove > a").on("click",function(){$(this).after('<div class="ajax-progress ajax-progress-throbber"><div class="throbber"></div></div>');var a=$(this).parent().attr("id");$.ajax({type:"POST",url:"/comment/prove/advisor/"+a,success:function(b){if(b[0]==1){$("#"+b[1]).closest(".comment").addClass("proved_by_advisor");f.find(".content .comment").each(function(){$(this).find(".group-left .advisor_aprove").remove()});$("#"+b[1]).find(".ajax-progress.ajax-progress-throbber").hide()}},error:function(b){console.log(b)}})});f.find(".asker_aprove > a").on("click",function(){$(this).after('<div class="ajax-progress ajax-progress-throbber"><div class="throbber"></div></div>');var a=$(this).parent().attr("id");$.ajax({type:"POST",url:"/comment/prove/asker/"+a,success:function(b){if(b[0]==1){$("#"+b[1]).closest(".comment").addClass("proved_by_asker");f.find(".content .comment").each(function(){$(this).find(".group-left .asker_aprove").remove()});$("#"+b[1]).find(".ajax-progress.ajax-progress-throbber").hide()}},error:function(b){console.log(b)}})});f.find("#comments h2.title.comment-form").attr("id","answer-question");f.find(".answer_link > a").click(function(a){a.preventDefault();if(f.hasClass("not-logged-in")){f.find("#block-panels-mini-user-panel h2.block-title").click()}else{$("html, body").animate({scrollTop:($("#answer-question").offset().top-80)},700)}});$(".field-name-question-statistic .statistics").prepend('<div class="share-title">اشتراک</div>');f.find(".node-questions.view-mode-full > .group-header .field-name-question-statistic .statistics .share-title").click(function(){$(".node-questions.view-mode-full > .group-header .field-name-field-social-share").toggleClass("open");$(".node-questions.view-mode-full > .group-header .field-name-field-social-share .field-items").slideToggle()});$(".node-questions.view-mode-full.node-unpublished > .group-header .flag-outer.flag-outer-follow-question").before('<div class="not-published-btn"> تایید نشده </div>');if(Drupal.settings.Uid==Drupal.settings.asker){var h=window.location.pathname.split("/")[2];$(".node-questions.view-mode-full > .group-header .flag-outer.flag-outer-follow-question").before('<div class="edit-link"><a href="/node/'+h+'/edit" target="_blank" >ویرایش</a></div>')}});Drupal.behaviors.question_pages={attach:function(d,c){$(".node-questions .comment-form .username:not(.has-img)").each(function(a){var h=$(this).attr("href").split("/");var b=$(this);var g="";$.ajax({url:"/user/"+h[2]+"/ajax/picture",success:function(f){var e=$.parseHTML(f.data);b.prepend(e);b.addClass("has-img")}})});$(".page-question.node-type-questions").find(".indented").each(function(){$(this).find(".group-left .group-more").each(function(){console.log($(this).find("ul").children().length);if($(this).find("ul").children().length>1){$(this).find(".comment-reply").css({display:"none"})}else{if($(this).find("ul").children().length==1){$(this).css({display:"none"})}}})})}};